<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Transform RBD Pieces with Alembic Layering | James Robinson üåä</title><meta name=keywords content="tip,rbd,alembic"><meta name=description content="Create two separate Alembic caches for geometry and transforms and combine them later"><meta name=author content><link rel=canonical href=https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/><link crossorigin=anonymous href=/assets/css/stylesheet.31a1ec8ce187fd44934e170601c332903bca9bc902e9bca2c4b7205cf7203d32.css integrity="sha256-MaHsjOGH/USTThcGAcMykDvKm8kC6byixLcgXPcgPTI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.jamesrobinsonvfx.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.jamesrobinsonvfx.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.jamesrobinsonvfx.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.jamesrobinsonvfx.com/apple-touch-icon.png><link rel=mask-icon href=https://www.jamesrobinsonvfx.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåä</text></svg>"><meta property="og:title" content="Transform RBD Pieces with Alembic Layering"><meta property="og:description" content="Create two separate Alembic caches for geometry and transforms and combine them later"><meta property="og:type" content="article"><meta property="og:url" content="https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/"><meta property="og:image" content="https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/images/preview.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-07-06T00:00:00+00:00"><meta property="article:modified_time" content="2021-07-06T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/images/preview.png"><meta name=twitter:title content="Transform RBD Pieces with Alembic Layering"><meta name=twitter:description content="Create two separate Alembic caches for geometry and transforms and combine them later"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blog ü™∂","item":"https://www.jamesrobinsonvfx.com/blog/"},{"@type":"ListItem","position":3,"name":"Transform RBD Pieces with Alembic Layering","item":"https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Transform RBD Pieces with Alembic Layering","name":"Transform RBD Pieces with Alembic Layering","description":"Create two separate Alembic caches for geometry and transforms and combine them later","keywords":["tip","rbd","alembic"],"articleBody":" Hipfile: jamesr_alembicrbdlayers.hip\nOr follow along on hdbp.io\nOverview There are plenty of ways to transfer RBD data from one application to another. Some facilities might have proprietary tools to make this pretty straightforward and quick. Others might use USD. But what if you don‚Äôt have either option?\nOne kind of interesting way of doing it is to use Alembic Layering.\nConcept Obstacles One thing we absolutely want to avoid when writing RBD geo to Alembic is writing all the pieces out as a single, unpacked deforming point cache. This is a huge waste of time and space because:\nAll of the points and mesh data will be written on each frame. We are forced to use deformation blur. If we need more detailed motion blur, we must write more motion samples into the cache. Multiply those factors by all of your iteration time and you get a really slow turnaround!\nPacked Geometry to the Rescue Houdini is perfectly capable of writing its own packed geometry format as packed Alembic primitives. Houdini treats each packed prim like its own object and so each primitive gets its own transform. This is great because:\nWe only need to wait for the mesh data to write into the Alembic cache once. Alembic caches are much smaller, since only one copy of the mesh data exists. The rest of the data is just time-varying attributes and transform matrices. We don‚Äôt need to use motion samples or deformation blur. Take it a Step Further This is all sounding pretty great! And for a small, lower-res sim this would probably suffice. But what if we have a bigger sim, with pretty high-res pieces? When writing the Alembic to disk, we would still need to wait for Houdini to transform the packed high res pieces, and write their transforms.\nInstead, what if we wrote the high-res static pieces to disk once, and anytime we wanted to change the sim and export it, we write only the transforms from the low-res sim to a cache, and leave the high-res static piece alone?\nAlembic let‚Äôs us do exactly that, using Alembic Layering!\nLayering The concept behind layering transforms is simple:\nWrite one static Alembic cache of the high-res pieces. Write one animated Alembic cache of only the transforms of each piece. Load the static cache, and layer the transforms on top so that they override the static static transforms. Requirements s@path Attribute Each piece needs to have a s@path attribute that corresponds to its place in a a hierarchy. It‚Äôs important that each piece has room for both a Transform and Shape. Here‚Äôs an example of a good looking s@path:\nSet Path from Name\ns@path = sprintf(\"pieces_grp/%s_geo/%s_geoShape\", s@name, s@name); It‚Äôs also crucial that the paths on the high-res geometry and the low-res transform match up!\nPacked Geometry / Fragments It‚Äôs important that each piece is packed. This is how Houdini will get the transform it needs. Make sure that the pieces are backed before transforming them. If you‚Äôre using this method with a Copy to Points SOP, or a Transform Pieces SOP, make sure the geo is packed before moving them around. This way, the primintrinsic:packedfulltransform will actually get updated! (ie. don‚Äôt copy/xform the unpacked pieces, then use an Assemble SOP to pack ‚Äôem up after.)\nThere is a little trick to get the pivots to line up correctly, so please see the demo file for details on that if you‚Äôre exporting RBD pieces and noticing some misalignment!\nROP it Out Output\nIn order for the Alembic to work for our purposes, a few of the defaults need to be changed on the Alembic ROP.\nBoth ROPs Enable Hierarchy \u003e Build Hierarchy from Attribute. Ensure Path Attribute is the same as the one you made earlier. Geometry \u003e Packed Transform should be set to Merge With Parent Transform Disable Use Instancing Where Possible if this is an RBD sim with unique pieces. High Res Pieces Output Settings\nTransforms Cache Make sure to disable Create Shape Nodes. Low Res Xform Output Settings\nSince we are only concerned with storing the transformation of each piece, don‚Äôt write the shape data in this cache. Otherwise, it will overwrite the high res mesh completely when we layer it back in!\nImport in your DCC of Choice The most common target application is probably going to be Maya. I‚Äôm not too familiar with the procedurals for any other render engine aside from Arnold, so I‚Äôll stick to what I know.\nIf you‚Äôre rendering with Arnold in Houdini, it‚Äôs as simple as setting the render flag of an object to render an Alembic SOP. Arnold will render Packed Alembics as procedurals by default.\nAlembic SOP in Houdini with layers\nRecommendations Do Don‚Äôt Load Alembic as a GPU Cache (Maya) or as an Arnold Standin Procedural Do Not just do a File \u003e Import and load the cache as Maya geometry. For a heavy sim with thousands of transforms and shape nodes, you‚Äôre likely to crash Maya! ","wordCount":"830","inLanguage":"en","image":"https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/images/preview.png","datePublished":"2021-07-06T00:00:00Z","dateModified":"2021-07-06T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/"},"publisher":{"@type":"Organization","name":"James Robinson üåä","logo":{"@type":"ImageObject","url":"https://www.jamesrobinsonvfx.com/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.jamesrobinsonvfx.com accesskey=h title="James Robinson üåä (Alt + H)">James Robinson üåä</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.jamesrobinsonvfx.com title="blog ü™∂"><span>blog ü™∂</span></a></li><li><a href=https://www.jamesrobinsonvfx.com/projects title="projects ü™õ"><span>projects ü™õ</span></a></li><li><a href=https://www.jamesrobinsonvfx.com/snippets title="snippets üß∞"><span>snippets üß∞</span></a></li><li><a href=https://www.jamesrobinsonvfx.com/links title="links üîó"><span>links üîó</span></a></li><li><a href=https://www.jamesrobinsonvfx.com/about title="about üëã"><span>about üëã</span></a></li><li><a href=https://www.jamesrobinsonvfx.com/search/ title="search üîç"><span>search üîç</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Transform RBD Pieces with Alembic Layering</h1><div class=post-meta><span title='2021-07-06 00:00:00 +0000 UTC'>July 6, 2021</span>&nbsp;¬∑&nbsp;4 min</div></header><figure class=entry-cover><a href=https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/images/preview.png target=_blank rel="noopener noreferrer"><img loading=lazy srcset="https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/images/preview_hu8083e806a5e1bedf3fd9066f0c18bbd6_289501_360x0_resize_box_3.png 360w ,https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/images/preview_hu8083e806a5e1bedf3fd9066f0c18bbd6_289501_480x0_resize_box_3.png 480w ,https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/images/preview_hu8083e806a5e1bedf3fd9066f0c18bbd6_289501_720x0_resize_box_3.png 720w ,https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/images/preview.png 1022w" sizes="(min-width: 768px) 720px, 100vw" src=https://www.jamesrobinsonvfx.com/blog/xform-pieces-alembic-layering/images/preview.png alt="Cover Photo" width=1022 height=681></a><p>Transforming Alembic pieces</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#overview aria-label=Overview>Overview</a></li><li><a href=#concept aria-label=Concept>Concept</a><ul><li><a href=#obstacles aria-label=Obstacles>Obstacles</a></li><li><a href=#packed-geometry-to-the-rescue aria-label="Packed Geometry to the Rescue">Packed Geometry to the Rescue</a></li><li><a href=#take-it-a-step-further aria-label="Take it a Step Further">Take it a Step Further</a></li><li><a href=#layering aria-label=Layering>Layering</a></li></ul></li><li><a href=#requirements aria-label=Requirements>Requirements</a><ul><li><a href=#spath-attribute aria-label="s@path Attribute"><code>s@path</code> Attribute</a></li><li><a href=#packed-geometry--fragments aria-label="Packed Geometry / Fragments">Packed Geometry / Fragments</a></li></ul></li><li><a href=#rop-it-out aria-label="ROP it Out">ROP it Out</a><ul><li><a href=#both-rops aria-label="Both ROPs">Both ROPs</a></li><li><a href=#transforms-cache aria-label="Transforms Cache">Transforms Cache</a></li></ul></li><li><a href=#import-in-your-dcc-of-choice aria-label="Import in your DCC of Choice">Import in your DCC of Choice</a><ul><li><a href=#recommendations aria-label=Recommendations>Recommendations</a></li></ul></li></ul></div></details></div><div class=post-content><blockquote><p>Hipfile: <a href=houdini/hip/jamesr_alembicrbdlayers.hiplc>jamesr_alembicrbdlayers.hip</a></p><p>Or follow along on <a href=https://hdbp.io/xsx5HQz2>hdbp.io</a></p></blockquote><figure><video class=videoj width=100% autoplay loop muted playsinline src=images/xform-pieces.mp4></video><figcaption><p></p></figcaption></figure><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>üîó</a></h2><p>There are plenty of ways to transfer RBD data from one application to another. Some facilities might have proprietary tools to make this pretty straightforward and quick. Others might use <a href=https://graphics.pixar.com/usd/docs/index.html>USD</a>. But what if you don&rsquo;t have either option?</p><p>One kind of interesting way of doing it is to use <strong>Alembic Layering</strong>.</p><h2 id=concept>Concept<a hidden class=anchor aria-hidden=true href=#concept>üîó</a></h2><h3 id=obstacles>Obstacles<a hidden class=anchor aria-hidden=true href=#obstacles>üîó</a></h3><p>One thing we <em>absolutely</em> want to avoid when writing RBD geo to Alembic is writing all the pieces out as a single, unpacked deforming point cache. This is a huge waste of time and space because:</p><ul><li>All of the points and mesh data will be written on each frame.</li><li>We are forced to use deformation blur.</li><li>If we need more detailed motion blur, we must write <em>more motion samples</em> into
the cache.</li></ul><p>Multiply those factors by all of your iteration time and you get a really slow turnaround!</p><h3 id=packed-geometry-to-the-rescue>Packed Geometry to the Rescue<a hidden class=anchor aria-hidden=true href=#packed-geometry-to-the-rescue>üîó</a></h3><p>Houdini is perfectly capable of writing its own packed geometry format as packed Alembic primitives. Houdini treats each packed prim like its own <em>object</em> and so each primitive gets its own <em>transform</em>. This is great because:</p><ul><li>We only need to wait for the mesh data to write into the Alembic cache once.</li><li>Alembic caches are much smaller, since only one copy of the mesh data exists.
The rest of the data is just time-varying attributes and transform matrices.</li><li>We don&rsquo;t need to use motion samples or deformation blur.</li></ul><h3 id=take-it-a-step-further>Take it a Step Further<a hidden class=anchor aria-hidden=true href=#take-it-a-step-further>üîó</a></h3><p>This is all sounding pretty great! And for a small, lower-res sim this would probably suffice. But what if we have a bigger sim, with pretty high-res pieces? When writing the Alembic to disk, we would still need to wait for Houdini to transform the packed high res pieces, and write their transforms.</p><p>Instead, what if we wrote the high-res static pieces to disk <em>once</em>, and anytime we wanted to change the sim and export it, we write <em>only</em> the transforms from the low-res sim to a cache, and leave the high-res static piece alone?</p><p>Alembic let&rsquo;s us do exactly that, using <em>Alembic Layering!</em></p><h3 id=layering>Layering<a hidden class=anchor aria-hidden=true href=#layering>üîó</a></h3><p>The concept behind layering transforms is simple:</p><ol><li>Write one static Alembic cache of the high-res pieces.</li><li>Write one animated Alembic cache of <em>only</em> the transforms of each piece.</li><li>Load the static cache, and layer the transforms on top so that they override
the static static transforms.</li></ol><h2 id=requirements>Requirements<a hidden class=anchor aria-hidden=true href=#requirements>üîó</a></h2><h3 id=spath-attribute><code>s@path</code> Attribute<a hidden class=anchor aria-hidden=true href=#spath-attribute>üîó</a></h3><p>Each piece needs to have a <code>s@path</code> attribute that corresponds to its place in a
a hierarchy. It&rsquo;s important that each piece has room for both a <strong>Transform</strong>
and <strong>Shape</strong>. Here&rsquo;s an example of a good looking <code>s@path</code>:</p><figure><img loading=lazy src=images/path-from-name.png alt="Set Path from Name"><figcaption><p>Set Path from Name</p></figcaption></figure><pre tabindex=0><code class=language-vex data-lang=vex>s@path = sprintf(&#34;pieces_grp/%s_geo/%s_geoShape&#34;, s@name, s@name);
</code></pre><p>It&rsquo;s also crucial that the paths on the high-res geometry and the low-res
transform match up!</p><h3 id=packed-geometry--fragments>Packed Geometry / Fragments<a hidden class=anchor aria-hidden=true href=#packed-geometry--fragments>üîó</a></h3><p>It&rsquo;s important that each piece is <em>packed</em>. This is how Houdini will get the transform it needs. Make sure that the pieces are backed <em>before</em> transforming them. If you&rsquo;re using this method with a <strong>Copy to Points</strong> SOP, or a <strong>Transform Pieces</strong> SOP, make sure the geo is packed <em>before</em> moving them around. This way, the <code>primintrinsic:packedfulltransform</code> will actually get updated! (ie. <em>don&rsquo;t</em> copy/xform the unpacked pieces, then use an <strong>Assemble</strong> SOP to pack &rsquo;em up <em>after</em>.)</p><blockquote><p>There is a little trick to get the pivots to line up correctly, so please see
the demo file for details on that if you&rsquo;re exporting RBD pieces and noticing
some misalignment!</p></blockquote><h2 id=rop-it-out>ROP it Out<a hidden class=anchor aria-hidden=true href=#rop-it-out>üîó</a></h2><figure><img loading=lazy src=images/network-output.png alt=Output><figcaption><p>Output</p></figcaption></figure><p>In order for the Alembic to work for our purposes, a few of the defaults need to be changed on the <strong>Alembic ROP</strong>.</p><h3 id=both-rops>Both ROPs<a hidden class=anchor aria-hidden=true href=#both-rops>üîó</a></h3><ul><li>Enable <strong>Hierarchy > Build Hierarchy from Attribute</strong>.</li><li>Ensure <strong>Path Attribute</strong> is the same as the one you made earlier.</li><li><strong>Geometry > Packed Transform</strong> should be set to <strong>Merge With Parent Transform</strong></li><li>Disable <strong>Use Instancing Where Possible</strong> if this is an RBD sim with unique pieces.</li></ul><figure><img loading=lazy src=images/high-res-pieces.png alt="High Res Pieces Output Settings"><figcaption><p>High Res Pieces Output Settings</p></figcaption></figure><h3 id=transforms-cache>Transforms Cache<a hidden class=anchor aria-hidden=true href=#transforms-cache>üîó</a></h3><ul><li>Make sure to disable <strong>Create Shape Nodes</strong>.</li></ul><figure><img loading=lazy src=images/low-res-xforms.png alt="Low Res Xform Output Settings"><figcaption><p>Low Res Xform Output Settings</p></figcaption></figure><blockquote><p>Since we are only concerned with storing the transformation of each piece, don&rsquo;t write the shape data in this cache. Otherwise, it will overwrite the high res mesh completely when we layer it back in!</p></blockquote><h2 id=import-in-your-dcc-of-choice>Import in your DCC of Choice<a hidden class=anchor aria-hidden=true href=#import-in-your-dcc-of-choice>üîó</a></h2><p>The most common target application is probably going to be Maya. I&rsquo;m not too familiar with the procedurals for any other render engine aside from <strong>Arnold</strong>, so I&rsquo;ll stick to what I know.</p><p>If you&rsquo;re rendering with Arnold in Houdini, it&rsquo;s as simple as setting the render flag of an object to render an Alembic SOP. Arnold will render Packed Alembics as procedurals by default.</p><figure><img loading=lazy src=images/layers.png alt="Alembic SOP in Houdini with layers"><figcaption><p>Alembic SOP in Houdini with layers</p></figcaption></figure><h3 id=recommendations>Recommendations<a hidden class=anchor aria-hidden=true href=#recommendations>üîó</a></h3><table><thead><tr><th>Do</th><th>Don&rsquo;t</th></tr></thead><tbody><tr><td>Load Alembic as a GPU Cache (Maya) or as an Arnold Standin Procedural</td><td><em>Do Not</em> just do a <code>File > Import</code> and load the cache as Maya geometry. For a heavy sim with thousands of transforms and shape nodes, you‚Äôre likely to crash Maya!</td></tr></tbody></table></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.jamesrobinsonvfx.com/tags/tip/>tip</a></li><li><a href=https://www.jamesrobinsonvfx.com/tags/rbd/>rbd</a></li><li><a href=https://www.jamesrobinsonvfx.com/tags/alembic/>alembic</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.jamesrobinsonvfx.com>James Robinson üåä</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.8)"})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>