<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Decay Values | James Robinson üåä</title><meta name=keywords content="solver,tips,vex"><meta name=description content="Decay values in a Solver SOP while respecting substeps"><meta name=author content><link rel=canonical href=https://www.jamesrobinsonvfx.com/blog/decay-values/><link crossorigin=anonymous href=/assets/css/stylesheet.c18f0e70982d46e72f09a1b9c081ddb26b145e34778ccbb832592b0ab8dcbd67.css integrity="sha256-wY8OcJgtRucvCaG5wIHdsmsUXjR3jMu4MlkrCrjcvWc=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.jamesrobinsonvfx.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.jamesrobinsonvfx.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.jamesrobinsonvfx.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.jamesrobinsonvfx.com/apple-touch-icon.png><link rel=mask-icon href=https://www.jamesrobinsonvfx.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåä</text></svg>"><meta property="og:title" content="Decay Values"><meta property="og:description" content="Decay values in a Solver SOP while respecting substeps"><meta property="og:type" content="article"><meta property="og:url" content="https://www.jamesrobinsonvfx.com/blog/decay-values/"><meta property="og:image" content="https://www.jamesrobinsonvfx.com/blog/decay-values/images/preview.jpg"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2021-08-22T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.jamesrobinsonvfx.com/blog/decay-values/images/preview.jpg"><meta name=twitter:title content="Decay Values"><meta name=twitter:description content="Decay values in a Solver SOP while respecting substeps"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blog ü™∂","item":"https://www.jamesrobinsonvfx.com/blog/"},{"@type":"ListItem","position":3,"name":"Decay Values","item":"https://www.jamesrobinsonvfx.com/blog/decay-values/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Decay Values","name":"Decay Values","description":"Decay values in a Solver SOP while respecting substeps","keywords":["solver","tips","vex"],"articleBody":" Hipfile: jamesr_decay.hip\nOne of the most common use cases for the Solver SOP is to accumulate values over time.\nAccumulating \u0026 Substeps Accumulating a value like color or density over time is pretty straightforward.\nAdd to the value from the previous timestep Clamp as needed f@density += chf(\"accumulate\"); f@density = clamp(f@density, 0, 1.0); When you introduce substeps, the accumulation can get a little crazy! Since the solver is doing this addition each timestep, you‚Äôll wind up increasing the value much more quickly than with just one substep. Luckily the solution is pretty straight forward: multiply your accumulation scale by f@TimeInc before adding.\nf@density += chf(\"accumulate\") * f@TimeInc; f@density = clamp(f@density, 0, 1.0); Decaying \u0026 Substeps Accumulating was easy enough right? At first you might think the same could be done for decaying or fading a value over time (like I did‚Ä¶oof!).\nIf you‚Äôre decreasing the value by subtracting, multiplying by f@TimeInc is just fine.\nBut if you‚Äôre doing a fading effect where you‚Äôre multiplying by some value between 0 and 1, multiplying by the time increment will actually have the opposite effect!\nImagine you start with a f@density value of 1.0, and you have a decay rate of 0.98. At 1 substep, each frame you are multiplying the previous value by 0.98. So by frame 2, your f@density attribute is 0.98, frame 3 0.9604‚Ä¶and so on.\nBut if you multiply your decay rate by the time increment, you get a number that‚Äôs much much lower!\n// f@Timeinc = 0.0416 0.98 * f@Timeinc = 0.040768 In this case, each substep we‚Äôd be multiplying the value by 0.040768. Even after just a single step we‚Äôd probably have all our value eaten away, which is exactly the problem we want to avoid.\nGet to the solution already! Alright alright, we actually have a few ways to solve this one.\nSubtract and Clamp This first way is similar to the additive accumulation method above (subtraction is really just addition in disguise anyways). Instead of decreasing the value by multiplying, we‚Äôll just subtract some small amount each timestep:\nv@Cd.x = max(0, v@Cd.x - (chf(\"decay\") * f@Timeinc)); Power Function The second way uses VEX‚Äôs pow() function to decay the value over time.\nThis method will have a different decaying behavior vs just doing a simple multiplication on a single substep. But it tends to look pretty natural so go ahead and try it out\nv@Cd.x *= pow(chf(\"decay\"), f@Timeinc); Easy as that! Try it in a Solver SOP with different substep values and see the comparison (or take a look at the attached hipfile). Should be pretty close.\nLinear Combination DOP This method is less for when you‚Äôre trying to do this in a SOP solver, and more for if you‚Äôre building a setup in DOPs (and want to use this microsolver for something!)\nIt‚Äôs really as simple and changing the dropdown next to the Coefficient parameter from None to e^Timestep. Looks pretty similar to what we just did above!\nGas Linear Combination DOP\n","wordCount":"497","inLanguage":"en","image":"https://www.jamesrobinsonvfx.com/blog/decay-values/images/preview.jpg","datePublished":"2021-08-22T00:00:00Z","dateModified":"2021-08-22T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.jamesrobinsonvfx.com/blog/decay-values/"},"publisher":{"@type":"Organization","name":"James Robinson üåä","logo":{"@type":"ImageObject","url":"https://www.jamesrobinsonvfx.com/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.jamesrobinsonvfx.com accesskey=h title="James Robinson üåä (Alt + H)">James Robinson üåä</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.jamesrobinsonvfx.com title="blog ü™∂"><span>blog ü™∂</span></a></li><li><a href=https://www.jamesrobinsonvfx.com/projects title="projects ü™õ"><span>projects ü™õ</span></a></li><li><a href=https://www.jamesrobinsonvfx.com/snippets title="snippets üß∞"><span>snippets üß∞</span></a></li><li><a href=https://www.jamesrobinsonvfx.com/links title="links üîó"><span>links üîó</span></a></li><li><a href=https://www.jamesrobinsonvfx.com/about title="about üëã"><span>about üëã</span></a></li><li><a href=https://www.jamesrobinsonvfx.com/search/ title="search üîç"><span>search üîç</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Decay Values</h1><div class=post-meta><span title='2021-08-22 00:00:00 +0000 UTC'>August 22, 2021</span>&nbsp;¬∑&nbsp;3 min</div></header><figure class=entry-cover><a href=https://www.jamesrobinsonvfx.com/blog/decay-values/images/preview.jpg target=_blank rel="noopener noreferrer"><img loading=lazy srcset="https://www.jamesrobinsonvfx.com/blog/decay-values/images/preview_hu46319f75aef3823f7bc1305bfd4cc6e4_32985_360x0_resize_q75_box.jpg 360w ,https://www.jamesrobinsonvfx.com/blog/decay-values/images/preview_hu46319f75aef3823f7bc1305bfd4cc6e4_32985_480x0_resize_q75_box.jpg 480w ,https://www.jamesrobinsonvfx.com/blog/decay-values/images/preview_hu46319f75aef3823f7bc1305bfd4cc6e4_32985_720x0_resize_q75_box.jpg 720w ,https://www.jamesrobinsonvfx.com/blog/decay-values/images/preview.jpg 838w" sizes="(min-width: 768px) 720px, 100vw" src=https://www.jamesrobinsonvfx.com/blog/decay-values/images/preview.jpg alt="Cover Photo" width=838 height=641></a><p>Decaying attribute values</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#accumulating--substeps aria-label="Accumulating &amp;amp; Substeps">Accumulating & Substeps</a></li><li><a href=#decaying--substeps aria-label="Decaying &amp;amp; Substeps">Decaying & Substeps</a></li><li><a href=#get-to-the-solution-already aria-label="Get to the solution already!">Get to the solution already!</a><ul><li><a href=#subtract-and-clamp aria-label="Subtract and Clamp">Subtract and Clamp</a></li><li><a href=#power-function aria-label="Power Function">Power Function</a></li><li><a href=#linear-combination-dop aria-label="Linear Combination DOP">Linear Combination DOP</a></li></ul></li></ul></div></details></div><div class=post-content><blockquote><p>Hipfile: <a href=houdini/hip/jamesr_decay.hiplc>jamesr_decay.hip</a></p></blockquote><p>One of the most common use cases for the <strong>Solver SOP</strong> is to accumulate values over time.</p><h3 id=accumulating--substeps>Accumulating & Substeps<a hidden class=anchor aria-hidden=true href=#accumulating--substeps>üîó</a></h3><p>Accumulating a value like color or density over time is pretty straightforward.</p><ul><li>Add to the value from the previous timestep</li><li>Clamp as needed</li></ul><pre tabindex=0><code class=language-vex data-lang=vex>f@density += chf(&#34;accumulate&#34;);
f@density = clamp(f@density, 0, 1.0);
</code></pre><p>When you introduce substeps, the accumulation can get a little crazy! Since the solver is doing this addition <em>each timestep</em>, you&rsquo;ll wind up increasing the value much more quickly than with just one substep. Luckily the solution is pretty straight forward: multiply your accumulation scale by <code>f@TimeInc</code> before adding.</p><pre tabindex=0><code class=language-vex data-lang=vex>f@density += chf(&#34;accumulate&#34;) * f@TimeInc;
f@density = clamp(f@density, 0, 1.0);
</code></pre><h3 id=decaying--substeps>Decaying & Substeps<a hidden class=anchor aria-hidden=true href=#decaying--substeps>üîó</a></h3><p>Accumulating was easy enough right? At first you might think the same could be done for decaying or fading a value over time (<a href=https://forums.odforce.net/topic/30990-solver-sop-and-substeps/>like I did</a>&mldr;oof!).</p><p>If you&rsquo;re decreasing the value by subtracting, multiplying by <code>f@TimeInc</code> is just fine.</p><p>But if you&rsquo;re doing a fading effect where you&rsquo;re multiplying by some value between 0 and 1, multiplying by the time increment will actually have <em>the opposite</em> effect!</p><p>Imagine you start with a <code>f@density</code> value of <code>1.0</code>, and you have a decay rate of <code>0.98</code>. At 1 substep, each frame you are multiplying the previous value by <code>0.98</code>. So by frame 2, your <code>f@density</code> attribute is <code>0.98</code>, frame 3 <code>0.9604</code>&mldr;and so on.</p><p>But if you multiply your decay rate by the time increment, you get a number that&rsquo;s much much lower!</p><pre tabindex=0><code>// f@Timeinc = 0.0416
0.98 * f@Timeinc = 0.040768
</code></pre><p>In this case, each <em>substep</em> we&rsquo;d be multiplying the value by <code>0.040768</code>. Even after just a single step we&rsquo;d probably have all our value eaten away, which is exactly the problem we want to avoid.</p><h3 id=get-to-the-solution-already>Get to the solution already!<a hidden class=anchor aria-hidden=true href=#get-to-the-solution-already>üîó</a></h3><p>Alright alright, we actually have a few ways to solve this one.</p><h4 id=subtract-and-clamp>Subtract and Clamp<a hidden class=anchor aria-hidden=true href=#subtract-and-clamp>üîó</a></h4><p>This first way is similar to the additive accumulation method above (subtraction is really just addition in disguise anyways). Instead of decreasing the value by multiplying, we&rsquo;ll just subtract some small amount each timestep:</p><pre tabindex=0><code>v@Cd.x = max(0, v@Cd.x - (chf(&#34;decay&#34;) * f@Timeinc));
</code></pre><h4 id=power-function>Power Function<a hidden class=anchor aria-hidden=true href=#power-function>üîó</a></h4><p>The second way uses VEX&rsquo;s <code>pow()</code> function to decay the value over time.</p><blockquote><p>This method will have a different decaying behavior vs just doing a simple multiplication on a single substep. But it tends to look pretty natural so go ahead and try it out</p></blockquote><pre tabindex=0><code>v@Cd.x *= pow(chf(&#34;decay&#34;), f@Timeinc);
</code></pre><p>Easy as that! Try it in a Solver SOP with different substep values and see the comparison (or take a look at the attached hipfile). Should be pretty close.</p><h4 id=linear-combination-dop>Linear Combination DOP<a hidden class=anchor aria-hidden=true href=#linear-combination-dop>üîó</a></h4><p>This method is less for when you&rsquo;re trying to do this in a SOP solver, and more for if you&rsquo;re building a setup in DOPs (and want to use this microsolver for something!)</p><p>It&rsquo;s really as simple and changing the dropdown next to the <strong>Coefficient</strong> parameter from <strong>None</strong> to <code>e^Timestep</code>. Looks pretty similar to what we just did above!</p><figure><img loading=lazy src=images/linear-combo-dop.jpg alt="Gas Linear Combination DOP"><figcaption><p>Gas Linear Combination DOP</p></figcaption></figure></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.jamesrobinsonvfx.com/tags/solver/>solver</a></li><li><a href=https://www.jamesrobinsonvfx.com/tags/tips/>tips</a></li><li><a href=https://www.jamesrobinsonvfx.com/tags/vex/>vex</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.jamesrobinsonvfx.com>James Robinson üåä</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.8)"})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>